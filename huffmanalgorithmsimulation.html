<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Huffman Algorithm Simulator</title>
  <link rel="stylesheet" href="huffmancss.css">	
</head>
<body>
  <h2>Huffman Algorithm Simulator</h2>
  <table id="dynamicTable">
    <thead>
      <tr>
        <th>Symbol</th>
        <th>Code</th>
        <th>Code Length</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>

  <div class="taskbar">
    <button id="inputBtn">Input</button>
    <button id="buildHuffmanBtn">Build Huffman Tree</button>
    <button id="encryDecryBtn">Encode/Decode</button>
	<button onclick="calculateTotalBits()">Calculate Total Bits</button>
    <button id="resetBtn">Reset</button>
  </div>

  <div id="inputInterface">
    <div class="input-header">
      <span>Input Panel (Fill your inputs in the below field. Use the + button in the right side of this panel to add a new set of inputs and X button to temporily close this panel. After closing the input panel, click the button "Build Huffmann Tree" to see the results.)</span>
<button id="infoBtn">i</button>
<iframe id="iframeOverlay" sandbox="allow-scripts allow-same-origin"></iframe>
<script>
  const infoBtn = document.getElementById('infoBtn');
  const iframeOverlay = document.getElementById('iframeOverlay');

const iframeContent = `
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <style>
      body {
        margin: 80px;  
        justify-content: center; 
        align-items: center; 
        max-width: 100vw;
		height: 100vh; 
        background: #0a1f44; 
        color: white; 
        font-family: sans-serif;
      }
      .closebutton {
        position: fixed;
        top: 30px;
        left: 20px;
        background: #d9534f;
        border: none;
        color: white;
        padding: 10px 14px;
        font-size: 16px;
        border-radius: 6px;
        cursor: pointer;
      }
#instructions {
  max-width: 700px;          /* limit width */
  margin: 70px auto 20px;    /* center horizontally, push down for close button */
}
    </style>
  </head>
  <body>
    <button class="closebutton" id="closeBtn">Close</button>
<section id="instructions" style="background:#102b5a; color:white; padding:20px; border-radius:8px; max-width: 2000px; margin: 20px auto; font-family: 'Segoe UI', sans-serif;">
  <h2>Huffman Algorithm Simulator â€” Instructions</h2>

  <h3>1. What is the Huffman Algorithm?</h3>
  <p>
    The Huffman Algorithm is a popular technique used for data compression. It creates a binary tree called a Huffman Tree based on the frequencies of characters in a dataset. Characters that appear more frequently get shorter codes, while less frequent characters get longer codes. This results in efficient encoding of data with fewer bits, minimizing storage space or transmission size.
  </p>

  <h3>2. What is this website about?</h3>
  <p>
    This website is an interactive Huffman Algorithm Simulator designed to help users understand and visualize how Huffman coding works. Users can input symbols and their frequencies, build the Huffman Tree, see the generated codes for each symbol, and encode/decode text using the generated codes.
  </p>

  <h3>3. How to use this website?</h3>
  <ul>
    <li>Input Panel: Click the Input button on the bottom taskbar to open the Input Panel. Enter your set of symbols (characters) and their respective frequencies. Use the + button inside the input panel to add new symbols. Use the Delete button next to each row to remove that symbol. Close the input panel by clicking the X button inside it.</li>
    <li>Build Huffman Tree: Click the Build Huffman Tree button to generate the Huffman codes for your input symbols. The table above will display each symbol, its Huffman code, and the code length.</li>
    <li>Encode / Decode Panel: Click the Encode/Decode button to open the panel where you can enter text to encode or binary to decode based on the current codes.</li>
    <li>Calculate Total Bits: Click this button to get the weighted total number of bits needed to encode your symbols with the current codes.</li>
    <li>Reset: Click to reset the page and clear all inputs and results.</li>
  </ul>

  <h3>4. What are the functions of the buttons on this website?</h3>
  <table style="width:100%; border-collapse: collapse; color: white; border: 1px solid #4682b4;">
    <thead style="background-color: #1e4f91;">
      <tr>
        <th style="padding: 10px; border: 1px solid #4682b4;">Button</th>
        <th style="padding: 10px; border: 1px solid #4682b4;">Function Description</th>
      </tr>
    </thead>
    <tbody>
      <tr style="background-color: #102b5a;">
        <td style="padding: 10px; border: 1px solid #4682b4;">Input</td>
        <td style="padding: 10px; border: 1px solid #4682b4;">Opens the input panel to add or edit symbols and their frequencies.</td>
      </tr>
      <tr>
        <td style="padding: 10px; border: 1px solid #4682b4;">+ (Add)</td>
        <td style="padding: 10px; border: 1px solid #4682b4;">Adds a new symbol-frequency input pair inside the input panel.</td>
      </tr>
      <tr style="background-color: #102b5a;">
        <td style="padding: 10px; border: 1px solid #4682b4;">X (Close Input)</td>
        <td style="padding: 10px; border: 1px solid #4682b4;">Closes the input panel.</td>
      </tr>
      <tr>
        <td style="padding: 10px; border: 1px solid #4682b4;">Delete (per row)</td>
        <td style="padding: 10px; border: 1px solid #4682b4;">Removes the corresponding symbol-frequency input row.</td>
      </tr>
      <tr style="background-color: #102b5a;">
        <td style="padding: 10px; border: 1px solid #4682b4;">Build Huffman Tree</td>
        <td style="padding: 10px; border: 1px solid #4682b4;">Builds the Huffman Tree and generates codes for each symbol, displaying them in the table.</td>
      </tr>
      <tr>
        <td style="padding: 10px; border: 1px solid #4682b4;">Encode/Decode</td>
        <td style="padding: 10px; border: 1px solid #4682b4;">Opens the encode/decode panel for text-to-binary and binary-to-text conversions using current codes.</td>
      </tr>
      <tr style="background-color: #102b5a;">
        <td style="padding: 10px; border: 1px solid #4682b4;">X (Close Encode/Decode)</td>
        <td style="padding: 10px; border: 1px solid #4682b4;">Closes the encode/decode panel.</td>
      </tr>
      <tr>
        <td style="padding: 10px; border: 1px solid #4682b4;">Calculate Total Bits</td>
        <td style="padding: 10px; border: 1px solid #4682b4;">Calculates weighted total bits needed to encode your symbols with current Huffman codes.</td>
      </tr>
      <tr style="background-color: #102b5a;">
        <td style="padding: 10px; border: 1px solid #4682b4;">Reset</td>
        <td style="padding: 10px; border: 1px solid #4682b4;">Resets the page and clears all inputs and outputs.</td>
      </tr>
      <tr>
        <td style="padding: 10px; border: 1px solid #4682b4;">Info (i)</td>
        <td style="padding: 10px; border: 1px solid #4682b4;">Opens informational overlay for help or tips.</td>
      </tr>
    </tbody>
  </table>
</section>
  <br><br>
  <br><br>
<style>
  /* Reduce text size only inside iframe overlay */
  #iframeOverlay {
    font-size: 12px !important;
  }
</style>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('closeBtn').addEventListener('click', () => {
          window.parent.postMessage('closeIframe', '*');
        });
      });
    <\/script>
  </body>
  </html>
`;

  infoBtn.addEventListener('click', () => {
    iframeOverlay.style.display = 'block';
    iframeOverlay.srcdoc = iframeContent;
  });

  window.addEventListener('message', (event) => {
    if (event.data === 'closeIframe') {
      iframeOverlay.style.display = 'none';
      iframeOverlay.srcdoc = ''; 
    }
  });
</script>
      <div class="innernew">
        <button id="addColumnBtn" class="add-col-btn">+</button>
        <button id="closeInput" class="add-col-btn">X</button>
      </div>
    </div>
    <div class="input-content">
      <div id="charRow" class="input-row">
        <label>Character</label>
      </div>
      <div id="probRow" class="input-row">
        <label>Frequency</label>
      </div>
<div id="deleteRow" class="input-row">
  <label>Delete</label>
</div>

    </div>
  </div>

  <div id="encryInterface">
    <div class="input-header">
      <span>Encode / Decode Panel</span>
      <button id="closeEncry" class="add-col-btn">X</button>
    </div>
    <div class="input-content">
      <div class="input-row">
        <label for="encodeInput">Encode</label>
        <input type="text" id="encodeInput" placeholder="Enter text to encode" autocomplete="off" />
      </div>
      <div class="input-row">
        <label for="decodeInput">Decode</label>
        <input type="text" id="decodeInput" placeholder="Enter binary to decode" autocomplete="off" />
      </div>
    </div>
  </div>

<script>
  let huffmanTree = null;
  let huffmanCodes = {};
  let treeBuilt = false;

  function buildHuffmanTree(symbols) {
    const nodes = symbols.map(({ char, prob }) => ({
      char,
      prob: parseFloat(prob),
      left: null,
      right: null
    }));

    while (nodes.length > 1) {
      nodes.sort((a, b) => a.prob - b.prob);
      const left = nodes.shift();
      const right = nodes.shift();
      const merged = {
        char: left.char + right.char,
        prob: left.prob + right.prob,
        left,
        right
      };
      nodes.push(merged);
    }
    return nodes[0];
  }

  function generateCodes(node, path = "", codes = {}) {
    if (!node.left && !node.right) {
      codes[node.char] = path || "0";
      return codes;
    }
    if (node.left) generateCodes(node.left, path + "0", codes);
    if (node.right) generateCodes(node.right, path + "1", codes);
    return codes;
  }

  function readPanelSymbols() {
    const chars = charRow.querySelectorAll("input");
    const probs = probRow.querySelectorAll("input");
    const symbols = [];
    for (let i = 0; i < chars.length; i++) {
      const char = chars[i].value.trim();
      const probRaw = probs[i].value.trim();
      const prob = parseFloat(probRaw);
      if (char !== "" && !isNaN(prob)) {
        symbols.push({ char, prob });
      }
    }
    return symbols;
  }

  function validateSymbols(symbols) {
    if (symbols.length === 0) {
      alert("Please enter at least one symbol with frequency.");
      return false;
    }
    const charsSet = new Set();
    for (const { char, prob } of symbols) {
      if (prob <= 0) {
        alert(`Frequency for symbol '${char}' must be positive.`);
        return false;
      }
      if (charsSet.has(char)) {
        alert(`Duplicate symbol '${char}' detected. Symbols must be unique.`);
        return false;
      }
      charsSet.add(char);
    }
    return true;
  }

  function normalizeSymbols(symbols) {
    const total = symbols.reduce((sum, s) => sum + s.prob, 0);
    return symbols.map(s => ({
      char: s.char,
      prob: s.prob / total
    }));
  }

  function updateDisplayTable() {
    if (!treeBuilt) return;
    const symbols = readPanelSymbols();
    if (!validateSymbols(symbols)) {
      clearTableRows();
      return;
    }
    const normalized = normalizeSymbols(symbols);
    const data = normalized.map(s => ({
      char: s.char,
      prob: s.prob,
      code: huffmanCodes[s.char] || "â€”"
    }));
    data.sort((a, b) => b.prob - a.prob);
    clearTableRows();
    for (const { char, code } of data) {
      const row = table.tBodies[0].insertRow();
      row.insertCell().textContent = char;
      row.insertCell().textContent = code;
       const codeLength = (code === "â€”") ? "â€”" : code.length;
       row.insertCell().textContent = codeLength;
    }
  }

  function clearTableRows() {
    const tbody = table.tBodies[0];
    while (tbody.firstChild) tbody.removeChild(tbody.firstChild);
  }

  function removePanelColumn(index) {
    const charInputs = charRow.querySelectorAll("input");
    const probInputs = probRow.querySelectorAll("input");
    if (charInputs[index]) charRow.removeChild(charInputs[index]);
    if (probInputs[index]) probRow.removeChild(probInputs[index]);
    buildTreeAndCodes();
    updateDisplayTable();
  }

  function buildTreeAndCodes() {
    const symbols = readPanelSymbols();
    if (!validateSymbols(symbols)) {
      huffmanTree = null;
      huffmanCodes = {};
      treeBuilt = false;
      return false;
    }
    const normalized = normalizeSymbols(symbols);
    huffmanTree = buildHuffmanTree(normalized);
    huffmanCodes = generateCodes(huffmanTree);
    treeBuilt = true;
    return true;
  }

  function encodeText(text) {
    let encoded = '';
    for (let char of text) {
      if (!(char in huffmanCodes)) return null;
      encoded += huffmanCodes[char];
    }
    return encoded;
  }

  function decodeBinary(binary) {
    if (!huffmanTree) return null;
    let result = '';
    let node = huffmanTree;
    for (let i = 0; i < binary.length; i++) {
      const bit = binary[i];
      if (bit !== '0' && bit !== '1') return null;
      node = bit === '0' ? node.left : node.right;
      if (!node) return null;
      if (!node.left && !node.right) {
        result += node.char;
        node = huffmanTree;
      }
    }
    if (node !== huffmanTree) return null;
    return result;
  }

  const encodeInput = document.getElementById("encodeInput");
  const decodeInput = document.getElementById("decodeInput");

  encodeInput.addEventListener("input", () => {
    if (!treeBuilt) {
      if (!buildTreeAndCodes()) {
        decodeInput.value = "";
        return;
      }
    }
    const input = encodeInput.value.trim();
    if (input === "") {
      decodeInput.value = "";
      return;
    }
    const encoded = encodeText(input);
    decodeInput.value = encoded !== null ? encoded : "Invalid input!";
  });

  decodeInput.addEventListener("input", () => {
    if (!treeBuilt) {
      if (!buildTreeAndCodes()) {
        encodeInput.value = "";
        return;
      }
    }
    const input = decodeInput.value.trim();
    if (input === "") {
      encodeInput.value = "";
      return;
    }
    const decoded = decodeBinary(input);
    encodeInput.value = decoded !== null ? decoded : "Invalid or incomplete binary!";
  });

  const inputBtn = document.getElementById("inputBtn");
  const buildBtn = document.getElementById("buildHuffmanBtn");
  const encryBtn = document.getElementById("encryDecryBtn");
  const resetBtn = document.getElementById("resetBtn");

  const inputInterface = document.getElementById("inputInterface");
  const closeInput = document.getElementById("closeInput");

  const encryInterface = document.getElementById("encryInterface");
  const closeEncry = document.getElementById("closeEncry");

  const addColumnBtn = document.getElementById("addColumnBtn");
  const charRow = document.getElementById("charRow");
  const probRow = document.getElementById("probRow");
  const table = document.getElementById("dynamicTable");
  
  const deleteRow = document.getElementById("deleteRow");

  inputBtn.addEventListener("click", () => {
    if (encryInterface.classList.contains("open")) {
      alert("Close the Encry/Decry panel first!");
      return;
    }
    inputInterface.classList.add("open");
    updateDisplayTable();
  });

  closeInput.addEventListener("click", () => {
    inputInterface.classList.remove("open");
  });

  encryBtn.addEventListener("click", () => {
    if (inputInterface.classList.contains("open")) {
      alert("Close the Input panel first!");
      return;
    }
    encryInterface.classList.add("open");
  });

  closeEncry.addEventListener("click", () => {
    encryInterface.classList.remove("open");
  });

addColumnBtn.addEventListener("click", () => {
  const charInput = document.createElement("input");
  charInput.type = "text";
  charInput.placeholder = "a, b, c...";
  charInput.addEventListener("input", () => {
    treeBuilt = false;
    updateDisplayTable();
  });

  const probInput = document.createElement("input");
  probInput.type = "number";
  probInput.min = "0";
  probInput.step = "any";
  probInput.placeholder = "1, 2, 3...";
  probInput.addEventListener("input", () => {
    treeBuilt = false;
    updateDisplayTable();
  });

  const delBtn = document.createElement("button");
  delBtn.textContent = "Delete";
  delBtn.className = "delete-btn";

  const index = charRow.children.length - 1; // exclude label

  delBtn.onclick = () => {
    charRow.removeChild(charRow.children[index + 1]);
    probRow.removeChild(probRow.children[index + 1]);
    deleteRow.removeChild(deleteRow.children[index + 1]);
    updateDisplayTable();
  };

  const charWrapper = document.createElement("div");
  charWrapper.style.display = "flex";
  charWrapper.style.alignItems = "center";
  charWrapper.style.gap = "6px";
  charWrapper.style.marginBottom = "6px";
  charWrapper.appendChild(charInput);

  const probWrapper = document.createElement("div");
  probWrapper.style.display = "flex";
  probWrapper.style.alignItems = "center";
  probWrapper.style.gap = "6px";
  probWrapper.style.marginBottom = "6px";
  probWrapper.appendChild(probInput);

  const delWrapper = document.createElement("div");
  delWrapper.style.display = "flex";
  delWrapper.style.alignItems = "center";
  delWrapper.style.gap = "6px";
  delWrapper.style.marginBottom = "6px";
  delWrapper.appendChild(delBtn);

  charRow.appendChild(charWrapper);
  probRow.appendChild(probWrapper);
  deleteRow.appendChild(delWrapper);

  updateDisplayTable();
});


  buildBtn.addEventListener("click", () => {
    const symbols = readPanelSymbols();
    if (!validateSymbols(symbols)) return;
    huffmanTree = null;
    huffmanCodes = {};
    treeBuilt = false;
    if (!buildTreeAndCodes()) return;
    updateDisplayTable();
    alert("Huffman Tree built successfully!");
  });

  resetBtn.addEventListener("click", () => {
    if (confirm("Are you sure you want to reset the entire page?")) {
      location.reload();
    }
  });

  addColumnBtn.click();
  
function calculateTotalBits() {
  const symbols = readPanelSymbols();
  if (!validateSymbols(symbols)) return;

  const normalized = normalizeSymbols(symbols);
  let totalBits = 0;

  for (const { char, prob } of normalized) {
    const code = huffmanCodes[char];
    if (code) {
      totalBits += prob * code.length;
    }
  }

  alert("Total number of bits (weighted): " + totalBits.toFixed(4));
}

</script>
</body>
</html>

